<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="description" content="An Open Source Project for secure and robust containerized application management for constrained devices.">
	<meta property="og:title" content="Open Horizon" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://localhost:4000///docs/developing/container_registry.html" />
<meta property="og:image" content="http://localhost:4000//img/hero-dark.jpg">

	

	<meta name="citation_title" content="Project Pages - An Integrated Scientific Blogging Template">



	

	<link rel='shortcut icon' type='image/png' href='/img/favicon.png' />

    <title>Open Horizon</title>

    <link rel="canonical" href="http://localhost:4000/docs/developing/container_registry.html">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="http://localhost:4000/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="http://localhost:4000/css/clean-blog.css">

	<!-- Adjust Colors -->
    <link rel="stylesheet" href="http://localhost:4000/css/colorscheme.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="http://localhost:4000/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="/css/normalize.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/cayman.css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<!-- Math Jax -->
	<script type="text/x-mathjax-config">
	MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
	</script>
	<script type="text/javascript"
	src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
	<script type="text/x-mathjax-config">
	MathJax.Hub.Config({
		TeX: { equationNumbers: { autoNumber: "AMS" } }
	});
	</script>

	<!--<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js" type="text/javascript"></script>-->

    <!-- jQuery -->
	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="http://localhost:4000/js/clean-blog.min.js "></script>

    <!-- Clipboard.js -->
    <script src="http://localhost:4000/js/clipboard.min.js " ></script>

    <!-- CDN Hosted Clipboard.js -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script> -->


	

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Open Horizon</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>

                <li>
                    <a href="/quick-start">Quick Start</a>
                </li>

                <li>
                    <a href="/docs/">Docs</a>
                </li>

                <!-- <li>
                    <a href="/blog">Blog</a>
                </li> -->

                <li>
                    <a href="/docs/getting_started/faq.html">FAQ</a>
                </li>


            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Page Header -->
<header class="intro-header" style="background-image: url('/img/hero-dark.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading" style="padding: 75px 0">
					
                    
                    

                    <h1 style="font-size:4.0em">Open Horizon</h1>
                    <hr class="small">

                    <span class="subheading">An Open Source Project for secure and robust containerized application management for constrained devices.</span>
                    

                </div>
            </div>
        </div>
    </div>
</header>

<div class="container">
	<div class="row">
      <div class="col-lg-12 col-md-12">
			
<h1 id="container_registry">Using a private container registry</h1>

<p class="shortdesc">If an edge service image includes assets that are not appropriate to include in a public registry, you can use a private Docker container registry, for example, the OpenShift Image Registry or the IBM Cloud Container Registry, where access is tightly controlled.</p>

<p>If you have not done so already, follow the steps in <a href="/docs/developing/developing.html">Developing an edge service for devices</a> to create and deploy at least one example edge service to ensure you are familiar with the basic process.</p>

<p>This page describes two registries you can store edge service images in:</p>
<ul>
  <li><a href="#ocp_image_registry">Using the OpenShift image registry</a></li>
  <li><a href="#ibm_cloud_container_registry">Using the IBM Cloud Container Registry</a></li>
</ul>

<p>These also serve as examples of how you can use any private image registry with Open Horizon (Open Horizon).</p>

<h2 id="ocp_image_registry">Using the OpenShift image registry</h2>

<h3 id="before-you-begin">Before you begin</h3>

<ul>
  <li>If you have not already done so, install the <a href="https://www.ibm.com/support/knowledgecenter/SSFC4F_1.3.0/cloudctl/install_cli.html">cloudctl command <img src="../images/icons/launch-glyph.svg" alt="Opens in a new tab" title="Opens in a new tab" /></a></li>
  <li>If you have not already done so, install the <a href="https://docs.openshift.com/container-platform/4.4/cli_reference/openshift_cli/getting-started-cli.html">OpenShift oc command <img src="../images/icons/launch-glyph.svg" alt="Opens in a new tab" title="Opens in a new tab" /></a></li>
  <li>
    <p>On macOS, you can install the OpenShift <strong>oc</strong> command using <a href="https://docs.brew.sh/Installation">homebrew <img src="../images/icons/launch-glyph.svg" alt="Opens in a new tab" title="Opens in a new tab" /></a></p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  brew <span class="nb">install </span>openshift-cli
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="procedure">Procedure</h3>

<p>Note: See <a href="/docs/getting_started/document_conventions.html">Conventions used in this document</a> for more information about command syntax.</p>

<ol>
  <li>
    <p>Ensure that you are connected to your OpenShift cluster with cluster administrator privileges.</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cloudctl login <span class="nt">-a</span> &lt;cluster-url&gt; <span class="nt">-u</span> &lt;user&gt; <span class="nt">-p</span> &lt;password&gt; <span class="nt">-n</span> kube-system <span class="nt">--skip-ssl-validation</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Determine if a default route for the OpenShift image registry has been create such that it is accessible from outside of the cluster:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oc get route default-route <span class="nt">-n</span> openshift-image-registry <span class="nt">--template</span><span class="o">=</span><span class="s1">''</span>
</code></pre></div>    </div>

    <p>If the command response indicates the <strong>default-route</strong> is not found, then create it (see <a href="https://docs.openshift.com/container-platform/4.4/registry/securing-exposing-registry.html">Exposing the registry <img src="../images/icons/launch-glyph.svg" alt="Opens in a new tab" title="Opens in a new tab" /></a> for details):</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oc patch configs.imageregistry.operator.openshift.io/cluster <span class="nt">--patch</span> <span class="s1">'{"spec":{"defaultRoute":true}}'</span> <span class="nt">--type</span><span class="o">=</span>merge
</code></pre></div>    </div>
  </li>
  <li>
    <p>Retrieve the repository route name you need to use:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OCP_DOCKER_HOST</span><span class="o">=</span><span class="sb">`</span>oc get route default-route <span class="nt">-n</span> openshift-image-registry <span class="nt">--template</span><span class="o">=</span><span class="s1">''</span><span class="sb">`</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create a new project to store your images in:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OCP_PROJECT</span><span class="o">=</span>&lt;your-new-project&gt;
oc new-project <span class="nv">$OCP_PROJECT</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create a service account with a name of your choosing:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OCP_USER</span><span class="o">=</span>&lt;service-account-name&gt;
oc create serviceaccount <span class="nv">$OCP_USER</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Add a role to your service account for the current project:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oc policy add-role-to-user edit system:serviceaccount:<span class="nv">$OCP_PROJECT</span>:<span class="nv">$OCP_USER</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Get the token assigned to your service account:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OCP_TOKEN</span><span class="o">=</span><span class="sb">`</span>oc serviceaccounts get-token <span class="nv">$OCP_USER</span><span class="sb">`</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Get the OpenShift certificate and have docker trust it:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> | openssl s_client <span class="nt">-connect</span> <span class="nv">$OCP_DOCKER_HOST</span>:443 <span class="nt">-showcerts</span> | <span class="nb">sed</span> <span class="nt">-n</span> <span class="s2">"/-----BEGIN CERTIFICATE-----/,/-----END CERTIFICATE-----/p"</span> <span class="o">&gt;</span> ca.crt
</code></pre></div>    </div>

    <p>On Linux:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> /etc/docker/certs.d/<span class="nv">$OCP_DOCKER_HOST</span>
<span class="nb">cp </span>ca.crt /etc/docker/certs.d/<span class="nv">$OCP_DOCKER_HOST</span>
systemctl restart docker.service
</code></pre></div>    </div>

    <p>On macOS:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/.docker/certs.d/<span class="nv">$OCP_DOCKER_HOST</span>
<span class="nb">cp </span>ca.crt ~/.docker/certs.d/<span class="nv">$OCP_DOCKER_HOST</span>
</code></pre></div>    </div>

    <p>On macOS, restart docker by clicking on the whale icon on the right-hand side of the desktop menu bar and selecting <strong>Restart</strong>.</p>
  </li>
  <li>
    <p>Login to the OCP Docker host:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$OCP_TOKEN</span><span class="s2">"</span> | docker login <span class="nt">-u</span> <span class="nv">$OCP_USER</span> <span class="nt">--password-stdin</span> <span class="nv">$OCP_DOCKER_HOST</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Configure additional trust stores for image registry access:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oc create configmap registry-config <span class="nt">--from-file</span><span class="o">=</span>&lt;external-registry-address&gt;<span class="o">=</span>ca.crt <span class="nt">-n</span> openshift-config
</code></pre></div>    </div>
  </li>
  <li>
    <p>Edit the new <code class="language-plaintext highlighter-rouge">registry-config</code>:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oc edit image.config.openshift.io cluster
</code></pre></div>    </div>
  </li>
  <li>
    <p>Update the <code class="language-plaintext highlighter-rouge">spec:</code> section with the following lines:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spec:
  additionalTrustedCA:
   name: registry-config
</code></pre></div>    </div>
  </li>
  <li>
    <p>Build your image with this path format, for example:</p>
  </li>
</ol>

<div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nb">export </span><span class="nv">BASE_IMAGE_NAME</span><span class="o">=</span>myservice
   docker build <span class="nt">-t</span> <span class="nv">$OCP_DOCKER_HOST</span>/<span class="nv">$OCP_PROJECT</span>/<span class="k">${</span><span class="nv">BASE_IMAGE_NAME</span><span class="k">}</span>_amd64:1.2.3 <span class="nt">-f</span> ./Dockerfile.amd64 <span class="nb">.</span>
</code></pre></div></div>

<ol>
  <li>In preparation for publishing your edge service, modify your <strong>service.definition.json</strong> file such that its <strong>deployment</strong> section references your image registry path. You can create service and pattern definition files like this using:</li>
</ol>

<div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   hzn dev service new <span class="nt">-s</span> <span class="nv">$BASE_IMAGE_NAME</span> <span class="nt">-i</span> <span class="nv">$OCP_DOCKER_HOST</span>/<span class="nv">$OCP_PROJECT</span>/<span class="nv">$BASE_IMAGE_NAME</span>
</code></pre></div></div>

<p>The <strong>&lt;base-image-name&gt;</strong> should be your base image name without the arch or version. You can then edit the variables in the created file <strong>horizon/hzn.json</strong> as necessary.</p>

<p>Or, if you have created your own service definition file, ensure the <strong>deployment.services.&lt;service-name&gt;.image</strong> field references your image registry path.</p>

<ol>
  <li>When your service image is ready to be published, push the image to your private container registry and publish the image to Horizon exchange:</li>
</ol>

<div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   hzn exchange service publish <span class="nt">-r</span> <span class="s2">"</span><span class="nv">$OCP_DOCKER_HOST</span><span class="s2">:</span><span class="nv">$OCP_USER</span><span class="s2">:</span><span class="nv">$OCP_TOKEN</span><span class="s2">"</span> <span class="nt">-f</span> horizon/service.definition.json
</code></pre></div></div>

<p>The <strong>-r “$OCP_DOCKER_HOST:$OCP_USER:$OCP_TOKEN”</strong> argument gives Open Horizon edge nodes the credentials to be able to pull the service image.</p>

<p>The command completes these tasks:</p>

<ul>
  <li>Pushes the Docker images to your IBM Cloud Container Registry, and get the digest of the image in the process.</li>
  <li>Signs the digest and the deployment information with your private key.</li>
  <li>Puts the service metadata (including the signature) into Horizon exchange.</li>
  <li>Puts your public key into Horizon exchange under the service definition so Horizon edge nodes can automatically retrieve the definition to verify your signatures when needed.</li>
  <li>Puts the OpenShift user and token into Horizon exchange under the service definition so Horizon edge nodes can automatically retrieve the definition when needed.</li>
</ul>

<h3 id="using_service">Using your service on Horizon edge nodes</h3>

<p>To allow your edge nodes to pull the necessary service images from the OCP image registry, you must configure docker on each edge node to trust the OpenShift certificate. Copy the <strong>ca.crt</strong> file to each edge node and then:</p>

<p>On Linux:</p>

<div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> /etc/docker/certs.d/<span class="nv">$OCP_DOCKER_HOST</span>
<span class="nb">cp </span>ca.crt /etc/docker/certs.d/<span class="nv">$OCP_DOCKER_HOST</span>
systemctl restart docker.service
</code></pre></div></div>

<p>On macOS:</p>

<div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/.docker/certs.d/<span class="nv">$OCP_DOCKER_HOST</span>
<span class="nb">cp </span>ca.crt ~/.docker/certs.d/<span class="nv">$OCP_DOCKER_HOST</span>
</code></pre></div></div>

<p>On macOS restart docker by clicking on the whale icon on the right hand side of the desktop menu bar and selecting <strong>Restart</strong>.</p>

<p>Now Horizon has everything that it needs to get this edge service image from the OpenShift image registry and deploy it to edge nodes as specified by the deployment pattern or policy you have created.</p>

<h2 id="ibm_cloud_container_registry">Using the IBM Cloud Container Registry</h2>

<h3 id="before-you-begin-1">Before you begin</h3>

<ul>
  <li>Install the <a href="https://cloud.ibm.com/docs/cli?topic=cloud-cli-install-ibmcloud-cli">IBM Cloud CLI tool (ibmcloud) <img src="../images/icons/launch-glyph.svg" alt="Opens in a new tab" title="Opens in a new tab" /></a>.</li>
  <li>Ensure you have <strong>Cluster administrator</strong> or <strong>team administrator</strong> access level in your IBM Cloud account.</li>
</ul>

<h3 id="procedure-1">Procedure</h3>

<ol>
  <li>
    <p>Log in to the IBM Cloud and target your organization:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ibmcloud login <span class="nt">-a</span> cloud.ibm.com <span class="nt">-u</span> &lt;cloud-username&gt; <span class="nt">-p</span> &lt;cloud-password
ibmcloud target <span class="nt">-o</span> &lt;organization-id&gt; <span class="nt">-s</span> &lt;space-id&gt;
</code></pre></div>    </div>

    <p>If you do not know your organization ID and space ID, you can log in to the <a href="https://cloud.ibm.com/">IBM Cloud console <img src="../images/icons/launch-glyph.svg" alt="Opens in a new tab" title="Opens in a new tab" /></a> find or create them.</p>
  </li>
  <li>
    <p>Create a cloud API key:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ibmcloud iam api-key-create &lt;key-name&gt; <span class="nt">-d</span> <span class="s2">"&lt;key-description&gt;"</span>
</code></pre></div>    </div>

    <p>Save the API key value (displayed in the line that starts with <strong>API Key</strong>) in a secure place and set it in this environment variable:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">CLOUD_API_KEY</span><span class="o">=</span>&lt;your-cloud-api-key&gt;
</code></pre></div>    </div>

    <p>Note: This API key is different from the OpenShift API key you created to use with the <code class="language-plaintext highlighter-rouge">hzn</code> command.</p>
  </li>
  <li>
    <p>Get the container-registry plugin and create your private registry namespace. (This registry namespace will be part of the path used to identify your docker image.)</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ibmcloud plugin <span class="nb">install </span>container-registry
<span class="nb">export </span><span class="nv">REGISTRY_NAMESPACE</span><span class="o">=</span>&lt;your-registry-namespace&gt;
ibmcloud cr namespace-add <span class="nv">$REGISTRY_NAMESPACE</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Log in to your Docker registry namespace:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ibmcloud cr login
</code></pre></div>    </div>

    <p>For more information about using <strong>ibmcloud cr</strong>, see <a href="https://cloud.ibm.com/docs/services/Registry/">ibmcloud cr CLI web documentation <img src="../images/icons/launch-glyph.svg" alt="Opens in a new tab" title="Opens in a new tab" /></a>. Additionally, you can run this command to view help information:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ibmcloud cr <span class="nt">--help</span>
</code></pre></div>    </div>

    <p>After you log in to your private namespace in the DockerHub, you do not need to use <code class="language-plaintext highlighter-rouge">docker login</code> to log in to the registry. You can use container registry paths similar to the following within your <strong>docker push</strong> and <strong>docker pull</strong> commands:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>us.icr.io/<span class="nv">$REGISTRY_NAMESPACE</span>/&lt;base-image-name&gt;_&lt;<span class="nb">arch</span><span class="o">&gt;</span>:&lt;version&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>Build your image with this path format, for example:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">BASE_IMAGE_NAME</span><span class="o">=</span>myservice
docker build <span class="nt">-t</span> us.icr.io/<span class="nv">$REGISTRY_NAMESPACE</span>/<span class="k">${</span><span class="nv">BASE_IMAGE_NAME</span><span class="k">}</span>_amd64:1.2.3 <span class="nt">-f</span> ./Dockerfile.amd64 <span class="nb">.</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>In preparation for publishing your edge service, modify your <strong>service.definition.json</strong> file such that its <strong>deployment</strong> section references your image registry path. You can create service and pattern definition files like this using:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hzn dev service new <span class="nt">-s</span> <span class="nv">$BASE_IMAGE_NAME</span> <span class="nt">-i</span> us.icr.io/<span class="nv">$REGISTRY_NAMESPACE</span>/<span class="nv">$BASE_IMAGE_NAME</span>
</code></pre></div>    </div>

    <p>The <strong>&lt;base-image-name&gt;</strong> should be your base image name without the arch or version. You can then edit the variables in the created file <strong>horizon/hzn.json</strong> as necessary.</p>

    <p>Or, if you have created your own service definition file, ensure the <strong>deployment.services.&lt;service-name&gt;.image</strong> field references your image registry path.</p>
  </li>
  <li>
    <p>When your service image is ready to be published, push the image to your private container registry and publish the image to Horizon exchange:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hzn exchange service publish <span class="nt">-r</span> <span class="s2">"us.icr.io:iamapikey:</span><span class="nv">$CLOUD_API_KEY</span><span class="s2">"</span> <span class="nt">-f</span> horizon/service.definition.json
</code></pre></div>    </div>

    <p>The <strong>-r “us.icr.io:iamapikey:$CLOUD_API_KEY”</strong> argument gives Open Horizon edge nodes the credentials to be able to pull the service image.</p>

    <p>The command completes these tasks:</p>

    <ul>
      <li>Pushes the Docker images to your IBM Cloud Container Registry, and get the digest of the image in the process.</li>
      <li>Signs the digest and the deployment information with your private key.</li>
      <li>Puts the service metadata (including the signature) into Horizon exchange.</li>
      <li>Puts your public key into Horizon exchange under the service definition so Horizon edge nodes can automatically retrieve the definition to verify your signatures when needed.</li>
      <li>Puts your IBM Cloud API key into Horizon exchange under the service definition so Horizon edge nodes can automatically retrieve the definition when needed.</li>
    </ul>
  </li>
  <li>
    <p>Verify that your service image was pushed to the IBM Cloud Container Registry:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ibmcloud cr images
</code></pre></div>    </div>
  </li>
  <li>
    <p>Publish a deployment pattern or policy that will deploy your service to some edge nodes. For example,:</p>

    <div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hzn exchange pattern publish <span class="nt">-f</span> horizon/pattern.json
</code></pre></div>    </div>
  </li>
</ol>

<p>Now Horizon has everything that it needs to get this edge service image from the IBM Cloud Container Registry and deploy it to edge nodes as specified by the deployment pattern or policy you have created.</p>

      </div>
	</div>
</div>

<hr>


	
    <!-- Footer -->
<footer>

    <div class="container">
        <div class="row">
             <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"> 
                 <ul class="list-inline text-center">
                    <!-- <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li> -->
                    
                    
                    
                    <li>
                        <a href="https://github.com/open-horizon">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
					
                    <li>
                        <a href="https://github.com/open-horizon/open-horizon.github.io/issues">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-exclamation fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		         <li>
                        <a href="https://wiki.lfedge.org/display/OH/Open+Horizon">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-info fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <!-- <li>
                        <a href="https://github.com/projectpages/project-pages/fork">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-code-fork fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li> -->
                    
                </ul> 

                <div align="center">
                  <div class="copytext"><p><a href="https://app.slack.com/client/THT8G7R0V/C011XLC1V2Q" target="_blank" style="text-decoration:none">Join Chat</a>   |   <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank" style="text-decoration:none">License</a>   |   ©2020 IBM. All rights reserved</p></div>

                </div>

        </div>
    </div>
</footer>


</body>

</html>
