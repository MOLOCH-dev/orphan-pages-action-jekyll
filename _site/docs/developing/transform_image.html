<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="description" content="An Open Source Project for secure and robust containerized application management for constrained devices.">
	<meta property="og:title" content="Open Horizon" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://localhost:4000///docs/developing/transform_image.html" />
<meta property="og:image" content="http://localhost:4000//img/hero-dark.jpg">

	

	<meta name="citation_title" content="Project Pages - An Integrated Scientific Blogging Template">



	

	<link rel='shortcut icon' type='image/png' href='/img/favicon.png' />

    <title>Open Horizon</title>

    <link rel="canonical" href="http://localhost:4000/docs/developing/transform_image.html">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="http://localhost:4000/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="http://localhost:4000/css/clean-blog.css">

	<!-- Adjust Colors -->
    <link rel="stylesheet" href="http://localhost:4000/css/colorscheme.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="http://localhost:4000/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="/css/normalize.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/cayman.css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<!-- Math Jax -->
	<script type="text/x-mathjax-config">
	MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
	</script>
	<script type="text/javascript"
	src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
	<script type="text/x-mathjax-config">
	MathJax.Hub.Config({
		TeX: { equationNumbers: { autoNumber: "AMS" } }
	});
	</script>

	<!--<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js" type="text/javascript"></script>-->

    <!-- jQuery -->
	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="http://localhost:4000/js/clean-blog.min.js "></script>

    <!-- Clipboard.js -->
    <script src="http://localhost:4000/js/clipboard.min.js " ></script>

    <!-- CDN Hosted Clipboard.js -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script> -->


	

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Open Horizon</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>

                <li>
                    <a href="/quick-start">Quick Start</a>
                </li>

                <li>
                    <a href="/docs/">Docs</a>
                </li>

                <!-- <li>
                    <a href="/blog">Blog</a>
                </li> -->

                <li>
                    <a href="/docs/getting_started/faq.html">FAQ</a>
                </li>


            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Page Header -->
<header class="intro-header" style="background-image: url('/img/hero-dark.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading" style="padding: 75px 0">
					
                    
                    

                    <h1 style="font-size:4.0em">Open Horizon</h1>
                    <hr class="small">

                    <span class="subheading">An Open Source Project for secure and robust containerized application management for constrained devices.</span>
                    

                </div>
            </div>
        </div>
    </div>
</header>

<div class="container">
	<div class="row">
      <div class="col-lg-12 col-md-12">
			
<h1 id="transform_image">Transform image to edge service</h1>

<p class="shortdesc">This example guides you through the steps to publish an existing Docker image as an edge service, create an associated deployment pattern, and register your edge nodes to run that deployment pattern.</p>

<h2 id="quickstart_ex_begin">Before you begin</h2>

<p>Complete the prerequisite steps in <a href="/docs/developing/service_containers.html">Preparing to create an edge service</a>. As a result, these environment variables should be set, these commands should be installed, and these files should exist:</p>

<div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"HZN_ORG_ID=</span><span class="nv">$HZN_ORG_ID</span><span class="s2">, HZN_EXCHANGE_USER_AUTH=</span><span class="nv">$HZN_EXCHANGE_USER_AUTH</span><span class="s2">, DOCKER_HUB_ID=</span><span class="nv">$DOCKER_HUB_ID</span><span class="s2">"</span>
which git jq
<span class="nb">ls</span> ~/.hzn/keys/service.private.key ~/.hzn/keys/service.public.pem
<span class="nb">cat</span> /etc/default/horizon
</code></pre></div></div>

<h2 id="quickstart_ex_procedure">Procedure</h2>

<p>Note: See <a href="/docs/getting_started/document_conventions.html">Conventions used in this document</a> for more information about command syntax.</p>

<ol>
  <li>
    <p>Create a project directory.</p>
  </li>
  <li>
    <p>On your development host, change to your existing Docker project directory. <strong>If you don’t have an existing Docker project, but still want to continue with this example</strong>, use these commands to create a simple Dockerfile that can be used with the rest of this procedure:</p>
  </li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
cat &lt;&lt; EndOfContent &gt; Dockerfile
FROM alpine:latest
CMD while :; do echo "Hello, world."; sleep 3; done
EndOfContent
```
{: codeblock}
</code></pre></div></div>

<ol>
  <li>Create edge service metadata for your project:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
hzn dev service new -s myservice -V 1.0.0 -i $DOCKER_HUB_ID/myservice --noImageGen
```
{: codeblock}

This command creates **horizon/service.definition.json** to describe your service and **horizon/pattern.json** to describe the deployment pattern. You can open these files and browse their content.
</code></pre></div></div>

<ol>
  <li>
    <p>Build and test your service.</p>
  </li>
  <li>
    <p>Build your docker image. The image name must match what is referenced in <strong>horizon/service.definition.json</strong>.</p>
  </li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
eval $(hzn util configconv -f horizon/hzn.json)
export ARCH=$(hzn architecture)
sudo docker build -t "${DOCKER_IMAGE_BASE}_$ARCH:$SERVICE_VERSION" .
unset DOCKER_IMAGE_BASE SERVICE_NAME SERVICE_VERSION
```
{: codeblock}
</code></pre></div></div>

<ol>
  <li>Run this service container image in the Horizon simulated agent environment:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
hzn dev service start -S
```
{: codeblock}
</code></pre></div></div>

<ol>
  <li>Verify that your service container is running:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
sudo docker ps
```
{: codeblock}
</code></pre></div></div>

<ol>
  <li>View the environment variables that were passed to the container when it was started. (These are the same environment variables that the full agent passes to the service container.)</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
sudo docker inspect $(sudo docker ps -q --filter name=myservice) | jq '.[0].Config.Env'
```
{: codeblock}
</code></pre></div></div>

<ol>
  <li>View the service container log:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>On **Linux**:

```bash
sudo tail -f /var/log/syslog | grep myservice[[]
```
{: codeblock}

On **macOS**:

```bash
sudo docker logs -f $(sudo docker ps -q --filter name=myservice)
```
{: codeblock}
</code></pre></div></div>

<ol>
  <li>Stop the service:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
hzn dev service stop
```
{: codeblock}
</code></pre></div></div>

<ol>
  <li>Publish your service to Open Horizon. Now that you verified that your service code runs as expected in the simulated agent environment, publish the service to Horizon exchange so that it becomes available for deployment to your edge nodes.</li>
</ol>

<p>The following <strong>publish</strong> command uses the <strong>horizon/service.definition.json</strong> file and your key pair to sign and publish your service to Horizon exchange. It also pushes your image to Docker Hub.</p>

<div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  hzn exchange service publish <span class="nt">-f</span> horizon/service.definition.json
  hzn exchange service list
</code></pre></div></div>

<ol>
  <li>Publish a deployment pattern for the service. This deployment pattern can be used by edge nodes to cause Open Horizon to deploy the service to them:</li>
</ol>

<div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  hzn exchange pattern publish <span class="nt">-f</span> horizon/pattern.json
  hzn exchange pattern list
</code></pre></div></div>

<ol>
  <li>
    <p>Register your edge node to run your deployment pattern.</p>
  </li>
  <li>
    <p>In the same way that you previously registered edge nodes with public deployment patterns from the <strong>IBM</strong> organization, register your edge node with the deployment pattern you published under your own organization:</p>
  </li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
hzn register -p pattern-myservice-$(hzn architecture) -s myservice --serviceorg $HZN_ORG_ID
```
{: codeblock}
</code></pre></div></div>

<ol>
  <li>List the docker container edge service that has been started as a result:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
sudo docker ps
```
{: codeblock}
</code></pre></div></div>

<ol>
  <li>View the myservice edge service output:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
sudo hzn service log -f myservice
```
{: codeblock}
</code></pre></div></div>

<ol>
  <li>View the node, service, and pattern that you have created in the Open Horizon console. You can display the console URL with:</li>
</ol>

<div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">'=|edge-exchange'</span> <span class="s1">'/^HZN_EXCHANGE_URL/ {print $2}'</span> /etc/default/horizon<span class="si">)</span><span class="s2">edge"</span>
</code></pre></div></div>

<ol>
  <li>Unregister your edge node and stop the <strong>myservice</strong> service:</li>
</ol>

<div class="language-bash codeblock highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  hzn unregister <span class="nt">-f</span>
</code></pre></div></div>

<h2 id="quickstart_ex_what_next">What to do next</h2>

<ul>
  <li>Try the other edge service examples at <a href="/docs/developing/developing.html">Developing edge services with Open Horizon</a>.</li>
</ul>

      </div>
	</div>
</div>

<hr>


	
    <!-- Footer -->
<footer>

    <div class="container">
        <div class="row">
             <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"> 
                 <ul class="list-inline text-center">
                    <!-- <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li> -->
                    
                    
                    
                    <li>
                        <a href="https://github.com/open-horizon">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
					
                    <li>
                        <a href="https://github.com/open-horizon/open-horizon.github.io/issues">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-exclamation fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		         <li>
                        <a href="https://wiki.lfedge.org/display/OH/Open+Horizon">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-info fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <!-- <li>
                        <a href="https://github.com/projectpages/project-pages/fork">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-code-fork fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li> -->
                    
                </ul> 

                <div align="center">
                  <div class="copytext"><p><a href="https://app.slack.com/client/THT8G7R0V/C011XLC1V2Q" target="_blank" style="text-decoration:none">Join Chat</a>   |   <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank" style="text-decoration:none">License</a>   |   ©2020 IBM. All rights reserved</p></div>

                </div>

        </div>
    </div>
</footer>


</body>

</html>
